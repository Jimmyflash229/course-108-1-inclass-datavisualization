---
title: "每週一圖作業範例"
output: html_document
params:
  組員: ["小明","小花"]  
  學號: ["410773818","410773293"]
---

#### 環境設定

以下為老師執行時一定會存在的環境設定
```{r basic setup, message=FALSE, echo=TRUE, eval=T}
Sys.setlocale("LC_ALL","Chinese")  #解決中文亂碼問題


library(dplyr); library(stringr); library(ggplot2); library(plotly); library(lubridate); library(readr); library(tidyr); library(showtext);library(ggthemes);library(tidyselect); library(grDevices) # 不同顏色模型代碼的呈現及轉換
library(scales) # show_col()螢幕立即顯示顏色
library(colorspace) # 調色盤選擇及ggplot應用工具
library(shinyjs) # 支援套件
library(magrittr)

font_add("QYuan","cwTeXQYuan-Medium.ttf") # 新增字體
showtext_auto(enable=TRUE) #啟用字體
theme_set(theme_classic())
knitr::opts_chunk$set(out.width='80%', fig.asp=.75, fig.align='center', fig.showtext=T)
```

#### 資料處理

此部份在做：

  * 原始Rda資料引入（即引入**dataList**物件）；
  
  * 資料清理成作圖用graphData物件。

請將你最原始的資料連同作業一起上傳到作業上傳網址：  
  * 若「原始資料為網頁下載」，且下載指令寫在data cleaning chunk裡的話，可以不用上傳「資料」。  
  * 若原始資料有很多個檔案，請先引入成data frame並存在「一個」.Rda檔裡上傳（如`example_data.Rda`檔）。  

資料檔引入到進入作圖前的資料處理請寫在下面區塊，分二部份：

  * 資料處理  
  * 作圖用資料物件生成
  
```{r data cleaning, echo=TRUE, eval=T}
# 資料引入
# 資料處理  
data_0 <- read_csv("C:/Users/Leo jay/Desktop/123123.csv",locale = locale(encoding = "BIG5"))
dataList <- list()
data_0$行業別 <- as.factor(data_0$行業別)

levels(data_0$行業別)

#data_0 %>%  filter( grepl("製造業", 行業別)) 

data_0 %>% mutate(
  工作領域 = as.factor(
    case_when
    (
    grepl("製造業", 行業別)                         |grepl("批發及零售業", 行業別)          |grepl("產業用機械設備維修及安裝業", 行業別) 
    |grepl("運輸及倉儲業", 行業別)                  |grepl("資訊及通訊傳播業", 行業別)      |grepl("營造業", 行業別)      
    |grepl("用水供應及污染整治業", 行業別)          |grepl("農、林、漁、牧業", 行業別)      |grepl("印刷及資料儲存媒體複製業", 行業別) 
    |grepl("礦業及土石採取業", 行業別)              |grepl("電力及燃氣供應業", 行業別)      |grepl("紡織業", 行業別)                ~ "第一、二級產業",
      
    grepl("服務業", 行業別)         |grepl("住宿及餐飲", 行業別)                             ~ "服務業",
    grepl("不動產業", 行業別)| grepl("金融及保險業", 行業別)                                ~ "金融保險及不動產"    ,
    grepl("公共行政及國防；強制性社會安全", 行業別)                                         ~ "公共行政及國防；強制性社會安全",  
    
    TRUE ~ as.character(行業別) )
  )
)       ->  data_1

data_1[-3]  ->dataList$sub0  
dataList$sub0[-1] ->dataList$sub
#dataList$sub1  %>% View()

dataList$sub %>% group_by(
  受傷部位,工作領域
) %>% summarise(
  受傷部位次數=sum(受傷部位次數)
) ->dataList$a


#dataList$a %>% View()
dataList$a$受傷部位 <- as.factor(dataList$a$受傷部位)

levels(dataList$a$受傷部位)

dataList$a %>% mutate(
  受傷部位=as.factor(
    case_when(
    受傷部位=="背"    |受傷部位=="腹"    |受傷部位=="肩"    |受傷部位=="肋骨"  |受傷部位=="前膊"  |受傷部位=="上膊"
    |受傷部位=="手"   |受傷部位=="胸"    |受傷部位=="腕"    |受傷部位=="指"    |受傷部位=="肘"    |受傷部位=="足"  
    |受傷部位=="股"   |受傷部位=="臀"    |受傷部位=="腿"    |受傷部位=="鼠蹊"   ~"身體(頭部以下)",
    受傷部位=="頭"    |受傷部位=="頸"    |受傷部位=="臉顏"    |受傷部位=="鎖骨"    ~"頭頸",
    受傷部位=="內臟"  ~"內臟",
    TRUE ~ "0000")
  )
)   ->dataList$b0
dataList$b0 %>% group_by(
  受傷部位,工作領域
) %>% summarise(
  受傷部位次數=sum(受傷部位次數)
) %>% ungroup    ->dataList$b1


graphData<-list()
dataList$b1[-(1:4),]   ->dataList$b   ->  graphData$data  


 
 
# 作圖用資料物件生成：處理好可進行作圖的資料請存在一個名為graphData的list物件裡
```


#### 繪圖程式

```{r graph, echo=T, eval=T}
graphData$data %>% ggplot(
  aes(x=受傷部位,y=受傷部位次數,fill=工作領域)
)+geom_col(
  position = "dodge"
  )+labs(
  title="各領域職業災害之受傷情況",
  caption ="資料來源:政府資料開放平台" ,element_text(hjust = 0.1)
)
```
```{r}
graphData$data %>% ggplot(
  aes(x=受傷部位,y=受傷部位次數,fill=工作領域)
)+geom_col(
  position = "dodge",width=1
  )+labs(
  title="各領域職業災害之受傷情況",
  caption ="資料來源:政府資料開放平台" ,element_text(hjust = 0.1)
)+coord_polar(theta = "y")




```
#### 設計說明
說明想傳達的訊息（必要）及設計想法（非必要）。寫在***之後
*** 

圖為台灣1995年之後的勞動力與就業人口趨勢，95年勞動力人口為9百21萬人，就業人口為9百零4萬5千人，就業比例（即就業率）為百分之98.21； ，到2018年勞動力人口為1千1百87萬4千人，就業人口為1千1百43萬4千人，就業率為百分之96.29。



